<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblical Board Game Cards</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Biblical Board Game - 
            Cards</h1>
        
        <div class="menu-container">
            <div class="dropdown">
                <button class="menu-btn">Game</button>
                <div class="dropdown-content">
                    <button id="start-btn">Start</button>
                </div>
            </div>
            
            <div class="dropdown">
                <button class="menu-btn">Cards</button>
                <div class="dropdown-content">
                    <div class="dropdown-submenu">
                        <span class="submenu-title">Filters</span>
                        <div class="dropdown-submenu-content">
                            <button class="filter-btn active" data-filter="all">All Cards</button>
                            <button class="filter-btn" data-filter="question">Questions</button>
                            <button class="filter-btn" data-filter="action">Actions</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dropdown">
                <button class="menu-btn">Actions</button>
                <div class="dropdown-content">
                    <button id="print-btn">Print Decks</button>
                </div>
            </div>
        </div>
        
        <!-- Game Board (initially hidden) -->
        <div id="game-board" class="game-board" style="display: none;">
            <div class="decks-container">
                <div class="deck-area">
                    <div id="question-deck" class="deck question-deck">
                        <div class="deck-label">Questions</div>
                    </div>
                    <div id="question-drawn" class="drawn-cards"></div>
                </div>
                
                <div class="deck-area">
                    <div id="action-deck" class="deck action-deck">
                        <div class="deck-label">Actions</div>
                    </div>
                    <div id="action-drawn" class="drawn-cards"></div>
                </div>
            </div>
        </div>
        
        <!-- Card Browser (initially shown) -->
        <div id="card-container">
            <!-- Cards will be dynamically generated here -->
        </div>
    </div>

    <!-- Include the data file first -->
    <script src="game-data.js"></script>
    
    <!-- Then the script that uses the data -->
    <script>
        // Game state variables
        let questionDeck = [];
        let actionDeck = [];
        let gameStarted = false;
        
        // Function to create cards from game data
        function createCards(filter = 'all', forPrinting = false) {
            const cardContainer = document.getElementById('card-container');
            
            // Clear existing cards if any
            cardContainer.innerHTML = '';
            
            // When printing, organize cards in pages of exactly 16 cards each (4x4 grid)
            if (forPrinting) {
                const filteredCards = gameData.cards.filter(card => {
                    return filter === 'all' || card.type === filter;
                });
                
                // Group cards into sets of exactly 16 for printing (4×4 grid)
                for (let i = 0; i < filteredCards.length; i += 16) {
                    const pageDiv = document.createElement('div');
                    pageDiv.className = 'card-display print-page';
                    
                    // Add up to 16 cards per page
                    const pageEnd = Math.min(i + 16, filteredCards.length);
                    for (let j = i; j < pageEnd; j++) {
                        const cardElement = createCardElement(filteredCards[j]);
                        pageDiv.appendChild(cardElement);
                    }
                    
                    // If we have fewer than 16 cards on the last page, add empty placeholder cards
                    // to maintain the grid structure
                    if (pageEnd - i < 16) {
                        for (let k = 0; k < 16 - (pageEnd - i); k++) {
                            const placeholderCard = document.createElement('div');
                            placeholderCard.className = 'card placeholder';
                            placeholderCard.style.visibility = 'hidden';
                            pageDiv.appendChild(placeholderCard);
                        }
                    }
                    
                    cardContainer.appendChild(pageDiv);
                }
            } else {
                // Regular display (not printing)
                const displayDiv = document.createElement('div');
                displayDiv.className = 'card-display';
                
                // Create cards from data
                gameData.cards.forEach(card => {
                    // Skip cards that don't match the filter
                    if (filter !== 'all' && card.type !== filter) {
                        return;
                    }
                    
                    const cardElement = createCardElement(card);
                    displayDiv.appendChild(cardElement);
                });
                
                cardContainer.appendChild(displayDiv);
            }
        }
        
        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Function to start the game
        function startGame() {
            // Hide card browser and show game board
            document.getElementById('card-container').innerHTML = '';
            document.getElementById('game-board').style.display = 'block';
            document.body.classList.add('in-game');
            
            // Get all question and action cards
            const questionCards = gameData.cards.filter(card => card.type === 'question');
            const actionCards = gameData.cards.filter(card => card.type === 'action');
            
            // Shuffle both decks
            questionDeck = shuffleArray([...questionCards]);
            actionDeck = shuffleArray([...actionCards]);
            
            // Clear drawn cards areas
            document.getElementById('question-drawn').innerHTML = '';
            document.getElementById('action-drawn').innerHTML = '';
            
            // Initialize decks
            setupDeckListeners();
            
            // Update start button to restart
            const startBtn = document.getElementById('start-btn');
            startBtn.textContent = 'Restart';
            
            gameStarted = true;
        }
        
        // Function to set up deck click listeners
        function setupDeckListeners() {
            const questionDeckElem = document.getElementById('question-deck');
            const actionDeckElem = document.getElementById('action-deck');
            
            questionDeckElem.onclick = () => {
                if (questionDeck.length > 0) {
                    drawCard('question');
                }
            };
            
            actionDeckElem.onclick = () => {
                if (actionDeck.length > 0) {
                    drawCard('action');
                }
            };
            
            // Update deck status visual cues
            updateDeckStatus();
        }
        
        // Function to draw a card from a deck
        function drawCard(deckType) {
            let card;
            let drawnCardsElem;
            
            if (deckType === 'question') {
                if (questionDeck.length === 0) return;
                card = questionDeck.pop();
                drawnCardsElem = document.getElementById('question-drawn');
            } else {
                if (actionDeck.length === 0) return;
                card = actionDeck.pop();
                drawnCardsElem = document.getElementById('action-drawn');
            }
            
            // Create a new card element
            const cardElement = createCardElement(card);
            cardElement.classList.add('card-in-drawn');
            
            // Add to drawn cards area
            drawnCardsElem.prepend(cardElement); // Add to beginning so newest is on top
            
            // Update deck status
            updateDeckStatus();
        }
        
        // Function to update the visual status of decks
        function updateDeckStatus() {
            const questionDeckElem = document.getElementById('question-deck');
            const actionDeckElem = document.getElementById('action-deck');
            
            // Update question deck
            if (questionDeck.length === 0) {
                questionDeckElem.classList.add('empty');
            } else {
                questionDeckElem.classList.remove('empty');
            }
            
            // Update action deck
            if (actionDeck.length === 0) {
                actionDeckElem.classList.add('empty');
            } else {
                actionDeckElem.classList.remove('empty');
            }
        }
        
        // Function to create a single card element
        function createCardElement(card) {
            // Create the card element
            const cardElement = document.createElement('div');
            cardElement.className = `card ${card.type}-card`;
            cardElement.setAttribute('data-id', card.id);
            
            // Create the card header
            const cardHeader = document.createElement('div');
            cardHeader.className = 'card-header';
            
            // Add the icon to the header
            const iconData = gameData.iconTypes[card.iconType] || gameData.iconTypes['bible']; // Default to bible icon
            const headerIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            headerIcon.setAttribute("class", "card-icon");
            headerIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
            headerIcon.setAttribute("viewBox", iconData.viewBox);
            
            const iconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            iconPath.setAttribute("d", iconData.path);
            headerIcon.appendChild(iconPath);
            
            // Create the header title
            const headerTitle = document.createElement('h2');
            headerTitle.textContent = card.type.charAt(0).toUpperCase() + card.type.slice(1);
            
            // Assemble the header
            cardHeader.appendChild(headerIcon);
            cardHeader.appendChild(headerTitle);
            
            // Create the card content
            const cardContent = document.createElement('div');
            cardContent.className = 'card-content';
            
            // Create the content paragraph with truncated text if needed
            const contentText = document.createElement('p');
            contentText.textContent = truncateText(card.content, 150); // Limit content length
            if (card.type === 'question') {
                contentText.className = 'question-text';
            }
            
            // Add options if they exist (with truncation)
            if (card.options && card.options.length > 0) {
                const optionsList = document.createElement('ul');
                optionsList.className = 'options-list';
                
                card.options.forEach(option => {
                    const optionItem = document.createElement('li');
                    optionItem.textContent = truncateText(option, 70); // Limit option length
                    optionsList.appendChild(optionItem);
                });
                
                cardContent.appendChild(contentText);
                cardContent.appendChild(optionsList);
            } else {
                cardContent.appendChild(contentText);
            }
            
            // Add content icon
            const contentIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            contentIcon.setAttribute("class", "content-icon");
            contentIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
            contentIcon.setAttribute("viewBox", iconData.viewBox);
            
            const contentIconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            contentIconPath.setAttribute("d", iconData.path);
            contentIcon.appendChild(contentIconPath);
            
            cardContent.appendChild(contentIcon);
            
            // Create the answer section for question cards (with truncation)
            if (card.type === 'question' && card.answer) {
                const answerSection = document.createElement('div');
                answerSection.className = 'card-answer';
                
                const answerText = document.createElement('p');
                answerText.textContent = `Answer: ${truncateText(card.answer, 120)}`; // Limit answer length
                
                answerSection.appendChild(answerText);
                cardElement.appendChild(cardHeader);
                cardElement.appendChild(cardContent);
                cardElement.appendChild(answerSection);
            } else {
                cardElement.appendChild(cardHeader);
                cardElement.appendChild(cardContent);
            }
            
            return cardElement;
        }
        
        // Function to truncate text to fit within cards
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength - 3) + '...';
        }
        
        // Initialize the filter buttons
        function initFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            let currentFilter = 'all';
            
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Exit game mode if we're in it
                    if (gameStarted) {
                        resetGameView();
                    }
                    
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    button.classList.add('active');
                    // Save the current filter
                    currentFilter = button.dataset.filter;
                    // Apply the filter
                    createCards(currentFilter);
                });
            });
            
            // Initialize print button
            document.getElementById('print-btn').addEventListener('click', () => {
                createDecksToPrint();
                
                // Add a brief delay to ensure the DOM has updated
                setTimeout(() => {
                    window.print();
                    
                    // After printing dialog is closed, restore the normal view
                    setTimeout(() => {
                        if (gameStarted) {
                            // If we were in game mode, reset to game view
                            document.getElementById('print-deck-container').remove();
                            document.getElementById('game-board').style.display = 'block';
                        } else {
                            // Otherwise, restore card browser
                            document.getElementById('print-deck-container').remove();
                            createCards(currentFilter);
                        }
                    }, 500);
                }, 100);
            });
            
            // Initialize start/restart button
            document.getElementById('start-btn').addEventListener('click', () => {
                if (gameStarted) {
                    // If the game is already started, restart it
                    startGame();
                } else {
                    // Start the game
                    startGame();
                }
            });
        }
        
        // Function to reset game view and go back to browsing mode
        function resetGameView() {
            document.getElementById('game-board').style.display = 'none';
            document.body.classList.remove('in-game');
            createCards('all');
            
            // Reset start button text
            const startBtn = document.getElementById('start-btn');
            startBtn.textContent = 'Start';
            
            gameStarted = false;
        }
        
        // Function to create decks for printing in a 4×3 grid layout (12 cards per page)
        function createDecksToPrint() {
            // Create a container for the printable cards (hidden for now)
            const printContainer = document.createElement('div');
            printContainer.id = 'print-deck-container';
            printContainer.style.display = 'none'; // Hide until print time
            document.querySelector('.container').appendChild(printContainer);
            
            // Add all cards for printing
            const allCardsDiv = document.createElement('div');
            allCardsDiv.className = 'print-all-cards';
            
            // Create cards from data for printing (all cards)
            const filteredCards = gameData.cards;
            
            // Group cards into sets of 12 for printing (4×3 grid)
            for (let i = 0; i < filteredCards.length; i += 12) {
                const cardPageDiv = document.createElement('div');
                cardPageDiv.className = 'card-print-page';
                
                // Add up to 12 cards per page (4×3 grid)
                const pageEnd = Math.min(i + 12, filteredCards.length);
                for (let j = i; j < pageEnd; j++) {
                    const card = filteredCards[j];
                    
                    // Create a print card that exactly matches the normal card structure
                    const printCard = document.createElement('div');
                    printCard.className = `print-card ${card.type}-card`;
                    printCard.setAttribute('data-id', card.id);
                    
                    // Create the card header
                    const cardHeader = document.createElement('div');
                    cardHeader.className = 'card-header';
                    
                    // Add the icon to the header with the same structure as normal cards
                    const iconData = gameData.iconTypes[card.iconType] || gameData.iconTypes['bible'];
                    const headerIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    headerIcon.setAttribute("class", "card-icon");
                    headerIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
                    headerIcon.setAttribute("viewBox", iconData.viewBox);
                    
                    const iconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    iconPath.setAttribute("d", iconData.path);
                    headerIcon.appendChild(iconPath);
                    
                    // Create the header title
                    const headerTitle = document.createElement('h2');
                    headerTitle.textContent = card.type.charAt(0).toUpperCase() + card.type.slice(1);
                    
                    // Assemble the header
                    cardHeader.appendChild(headerIcon);
                    cardHeader.appendChild(headerTitle);
                    
                    // Create the card content
                    const cardContent = document.createElement('div');
                    cardContent.className = 'card-content';
                    
                    // Create the content paragraph (no truncation for print)
                    const contentText = document.createElement('p');
                    contentText.textContent = card.content;
                    if (card.type === 'question') {
                        contentText.className = 'question-text';
                    }
                    
                    // Add options if they exist (no truncation for print)
                    if (card.options && card.options.length > 0) {
                        const optionsList = document.createElement('ul');
                        optionsList.className = 'options-list';
                        
                        card.options.forEach(option => {
                            const optionItem = document.createElement('li');
                            optionItem.textContent = option;
                            optionsList.appendChild(optionItem);
                        });
                        
                        cardContent.appendChild(contentText);
                        cardContent.appendChild(optionsList);
                    } else {
                        cardContent.appendChild(contentText);
                    }
                    
                    // Add content icon
                    const contentIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    contentIcon.setAttribute("class", "content-icon");
                    contentIcon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
                    contentIcon.setAttribute("viewBox", iconData.viewBox);
                    
                    const contentIconPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    contentIconPath.setAttribute("d", iconData.path);
                    contentIcon.appendChild(contentIconPath);
                    
                    cardContent.appendChild(contentIcon);
                    
                    // Create the answer section for question cards (no truncation for print)
                    if (card.type === 'question' && card.answer) {
                        const answerSection = document.createElement('div');
                        answerSection.className = 'card-answer';
                        
                        const answerText = document.createElement('p');
                        answerText.textContent = `Answer: ${card.answer}`;
                        
                        answerSection.appendChild(answerText);
                        printCard.appendChild(cardHeader);
                        printCard.appendChild(cardContent);
                        printCard.appendChild(answerSection);
                    } else {
                        printCard.appendChild(cardHeader);
                        printCard.appendChild(cardContent);
                    }
                    
                    cardPageDiv.appendChild(printCard);
                }
                
                // If we have fewer than 12 cards on the last page, add empty placeholder cards
                if (pageEnd - i < 12) {
                    for (let k = 0; k < 12 - (pageEnd - i); k++) {
                        const placeholderCard = document.createElement('div');
                        placeholderCard.className = 'print-card placeholder';
                        placeholderCard.style.visibility = 'hidden';
                        cardPageDiv.appendChild(placeholderCard);
                    }
                }
                
                allCardsDiv.appendChild(cardPageDiv);
            }
            
            printContainer.appendChild(allCardsDiv);
        }
        
        // When the page loads, create the cards and initialize filters
        window.addEventListener('DOMContentLoaded', () => {
            createCards();
            initFilters();
        });
    </script>
</body>
</html>